- hosts: all 
  become: yes
  vars_prompt:
          - name: hostname 
            prompt: 'What hostname to use?'
            private: no
          - name: home_ip
            promtp: 'Give the home IP number'
            private: no
  tasks:
          - name: Update distro
            apt:
                    upgrade: yes
                    update_cache: yes
          - name: Install sshpass
            apt:
                    name: sshpass
          - name: Turn on persistant hostname
            lineinfile:
                    path: /etc/cloud/cloud.cfg
                    regexp: '^preserve_hostname'
                    line: 'preserve_hostname: true'
          - name: Set Hostname
            shell: hostnamectl set-hostname {{ hostname }}
          - name: Write home networking config
            copy:
              dest: /etc/netplan/50-cloud-init.yaml
              content: |
                network:
                  ethernets:
                    ens3:
                      dhcp4: true
                    ens8:
                      dhcp4: false
                      addresses:
                      - {{home_ip}}/24
                      gateway4: 192.168.0.1
                      nameservers:
                        addresses:
                        - 192.168.0.1
                  version: 2
          - name: Run netplan apply
            shell: |
              netplan apply

          - name: Run swapoff
            shell: |
              swapoff -a
          - name: Remove swap from fstab
            replace:
                    path: /etc/fstab
                    regexp: '^([^#].*?\sswap\s+sw\s+.*)$'
                    replace: '# \1'
          - name: Install Docker
            apt:
                    update_cache: yes
                    name: docker.io
          - name: Enable Docker
            service:
                    name: docker
                    enabled: yes
          
